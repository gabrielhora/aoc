(ns aoc.y2020.day3
  (:require [clojure.string :as str]))

(def example "..##.......\n#...#...#..\n.#....#..#.\n..#.#...#.#\n.#...##..#.\n..#.##.....\n.#.#.#....#\n.#........#\n#.##...#...\n#...##....#\n.#..#...#.#")

(def input ".........#..##..#..#........#..\n#...#..#..#...##.....##.##.#...\n....#..............#....#....#.\n#.#..#.....#...#.##..#.#.#.....\n........#..#.#..#.......#......\n.#........#.#..###.#....#.#.#..\n........#........#.......#.....\n...##..#.#.#........##.........\n#.#.##..###............#...#...\n............#....#.......###.##\n....##....##..#........#......#\n............#.#..........#.....\n#.#....#....##...#.....#.....#.\n......#.#.#...#.....###....#..#\n...........##..#.........#..#.#\n..#..#.................#..#..#.\n.#....###...#.......#.........#\n#.#.#.#...#......#.......#...#.\n.......#.#.#...#..............#\n...##.......#..##.#.......##...\n#.#.##....#..##..##..###...###.\n.#......##.##.#....#.##........\n..###.............##..##..#....\n.....#.#...........#..##..##...\n.###.#.#......#.....#........##\n...#.......#...##..#..#..#.....\n..............#.#..##.##..##..#\n#..#.#......#............#.....\n........#..#....#..............\n...#...#..............#.#####..\n...##......#........#.#...#....\n..##......#............#..#..#.\n....#.........#.#.#.....###.#..\n#....#........#........#....#.#\n.....#...#..##.....##...#.....#\n#...#.#.#...##..##.###.#.#.....\n......#.#..........#...#.##....\n..............##...#..#.......#\n........##.....#.....#.#....#..\n..............#..#..#...#.....#\n##......##.......##...#.#....#.\n.....#.............#.#.........\n#.........##..#..#.........##..\n..#..#.....#####.........##.#..\n.......##.#......#........#....\n#.................#.#...#....#.\n...#........#.###.##.##.....#..\n#.....##..#...##.#.#......#....\n.....#..#.#..........##..#.##..\n..###.............#..#..#...#..\n...###..#...#.....##..........#\n#.......#.#...#....#..##..#..#.\n.#..#.........#..............#.\n..######.....#....##......#....\n#..##...#......#..#.#....#.....\n.#...................#.#.....#.\n..#...#.#..#.#......#..#...#..#\n..##..##.#.##.........#.#.#....\n...#...#...........#..##.##...#\n#...#....#....#....#..#.##..#..\n..#.##....#....###..#..........\n#.#..##.#.#...##.#..#.##..#.#..\n#......##...#.#..........#..#..\n#.#...#..#...#.#.#..#........#.\n#.#.##.#..#...#..#.#.##........\n.....#......#........#..#......\n...#....#.#....#...............\n....#..###..#....#..#....#....#\n.#........###..........##.##.#.\n#.#......##....##...##.#......#\n#..##.##...#...........##.#.#..\n.#.....#.#...#.................\n##..........#..#....#.....#...#\n....#.#..........##..#.....#.##\n#.#..#..#..##..........#.......\n..#.#.###......................\n......##..##.....#..##.##....#.\n...#.......#.##....#......#....\n...#...#........#...#.#...#..##\n##...#....#.#...#.#.##..##...#.\n...#.....#...#...#....###.#..#.\n..#.#..#........#......#..##..#\n...#......#...#.#.##...##.#.#.#\n....#.#....#....#.....#.....##.\n.....#.#..##.#....##....##.....\n.#...###..#.....#............#.\n#..#.#.#..#..#...#....#...#....\n#.....#..#...#................#\n..........#..#.......#......#.#\n...#..#......#...#......#......\n.#.#.....#.#.#.#......#..#..#..\n.....#.........#.#.#.....##.#..\n.....#.#.....#..#..#..#.....###\n##....#......##....##.#....#.#.\n#####........#..........##.....\n.#...##...#...#.......#....#...\n#.#.##...##...##..##........#..\n#.#..............#.#...#...###.\n...#.....##..#.........#....#.#\n#.#....#....#..##.#..#...#.....\n..#....#.#..#...#...##.....#...\n....#...#......................\n..#...#.......#..#...##....#...\n.#........#...#.....##.##...#..\n#......#..............#..#..#..\n...........#.#..#.#.#....#....#\n.##..##.......#...#..#.....#..#\n...#.........#.........###..#..\n...#.##....#....#.....#.....#..\n.#.#.#.........#.#.#....#....#.\n...#..........##..#....#.#.....\n...#....##................#....\n#....##..#..#........##...#....\n#...#...##.#............#....#.\n##..#....#...#...............#.\n..........#.#...#..##..#.#.....\n..##...##..#....#.#......#.....\n.......#......#.#.....#.....##.\n#...###.....##..##....#.#....#.\n.###......#.....#.#............\n#.....#.....####.##....#..#....\n......###.............#......##\n.........##.......##..#..#..#..\n.#.......#....#...#...#.#......\n#...#..#...#........#...##..#..\n.#....#........#.........##..#.\n..............##.#...##..#.##.#\n.#....#...#....#......#..#.....\n#....##.#...#.#.....###..#....#\n#.......##.#..###..............\n#..#..#..#......#.#..#...#..#.#\n.......#.#.#..#..#...#..#......\n.#..#......#.....#......##..##.\n....#....#.......#.......#.#.##\n.......#.#................#...#\n#.#.....#.......#.#........#...\n.....#....##...#......#.....##.\n.#......#.#...#..#....#....#.##\n##...#.###.#....#..#....#.#...#\n....#.##..##.#.............#...\n#..#.............##.......#.#..\n##.#..#..#.#...........###...##\n.#.#.....#......###........#...\n#.#...#.#....##......#.#....#..\n#.........#..........#.........\n.......#....#...#..#.....#...##\n.......................#...#..#\n.###...........##...#........##\n#.#....######.#........#..##.#.\n..#.##.#...#.#.......#.##.##..#\n#.............###..#.##.#......\n...#..##......#...#..###.....#.\n..........#.....#..#...##..#...\n..##..........#.#..#.....#...#.\n...#.......#.....##.........#..\n#..#.#...#..#...###...#...#.#..\n#.##....#..#.#.......#..#..#...\n..#.##.#......#.#......#....#..\n..........#...##.....###.......\n...#...##..#......#...##.......\n....#........#.#.......#..###..\n.....#.#..........##.#..#..#.#.\n.............##.....#.#..##....\n...#...............##...#......\n....#......#..#....#...##..#...\n.##.#....#.#.....#.#.........#.\n.....#.###....#..###..#.#.....#\n.#.........##.........##...#...\n..#.....###....##..........#..#\n........#..#.#.#..#.......#..##\n..#.#..#.#............#.##.#..#\n.#....#.....#..#...#.......##..\n.#...........#.#..#..###.###...\n..#.....#..#........#.#........\n.#........##........#..#.##....\n......#.....##........##..#....\n.#..................##....#.#..\n.#..#.#..#.#...#........#......\n...#..##.#......#..#..........#\n....#.##...#....##.............\n#....#.##....##.###..#..#..#...\n..........#..#...##.##....#..#.\n.###.#.....#...#...#...#.......\n............#...............#.#\n#....#...#......#....#.#.#.#.##\n...#..........#.#.#.....###....\n#.#...##...#..#.....###...#....\n......#...#..#..#..#.##...##...\n...#..#.#....#...#.#.........##\n##....#..###.#.##.....##.......\n..#.#...#..##.......#.#.......#\n##......#...........#......#...\n.......#..###....###..##.#...##\n.........#.....#..#.......##..#\n.......#.##..#....#...#.#...#..\n#..#.#..................##.#..#\n...#..#..#.....#..#........#...\n...#.#..###..#.....##...#....#.\n..#..#......#...........#...#..\n#...##.##..###.......##........\n.#.....#..#....#.....#.##....#.\n#..#........#.#....#..#...#.###\n..#...#.#.#.....#.....#..#.....\n.##.............#.#......##...#\n.#....#####............#.....##\n#.###.......#.#...##.....#.....\n......#.##..#...#..#..##.#..##.\n......#.#...##.....#...#....##.\n....#............#...#...#....#\n.........##.#.#....#....#....##\n.#...##.#...#.......#.##....#.#\n#....#.#...#.#...#.#.#...#.....\n.#.#.........##..#..#..........\n.#.........#.#.....#..#.#..###.\n....##.#.#..........#..####....\n....#..#.#.#...#...#..#....#...\n..#.#...#...##.......#.#.#..#..\n...##...#......#.....#.#...#..#\n......#.###.#.......##...#...#.\n.....#.#.#......##..........###\n##.#.#.#..#....#...............\n.#.#.##.......#....#.#.....#..#\n.........#...#.#..#.......#....\n....#.####.#......#...#...##...\n#..#..#..#..#....#...##.....##.\n......####.#..##..#.....##.....\n##.#.........#........#..#.#...\n.#.#....#....#.......#.#....##.\n....#....#.......##..#.....#...\n.#......#..#....#.#............\n#..#.#.##.....#..#.#.#.#.#.##..\n.#.....#.....#...#..#.#...#.#..\n.#.#.##............#.#.#.#.#.#.\n.##..........#.....#...###.....\n#.#...#...#................#.#.\n##...#.##.....#.....#.#.##.....\n####.....##..........#......#..\n#.............#..............#.\n.###....#.#...#..#..#..#.......\n..#.#.....#...#..#..####.......\n...#.#..#........#..##..#..#.##\n.#........#..........#.#...##..\n.#.......#.#.#..#...#..#.#...##\n.#.....##......##..............\n......#..#.#.##...##.#.....#...\n.........#.#...##.....##....#.#\n.....##...#........#..#.#..#.#.\n.#.##..#.....##...#...###.#.#..\n...##...#...#..#.#..#..........\n##..............#...#...#.#..#.\n......#..#......#..#.....#...#.\n.......#...#..#....#.....#.....\n..##.....##..#.#........#......\n.###.#...#.....................\n..#...#.................#...#..\n#..#.##...####.............#...\n.##....#..####.......#.........\n#..#...###...#...#..#..##......\n....#.##.#.#.........#.....#..#\n.....#...#.....#.#.#.##.#...##.\n.............#........#.....#..\n...##.###.#....##.......#..#...\n#..#....#....#.#............#..\n.........#.##........##.....#..\n.........#.#.#..#..#.......#...\n.......#.#..#.......#.....#.#..\n##.#.....##...##.....#.#.......\n.#.#.#......##.##.#.........#..\n..#.##..###.....###.........##.\n.#......#..#..##...#.#...##.#.#\n......#.#............#.....#...\n###.#..#..#..#..#.##...#.......\n.#.#.##..###....#......##..###.\n#...#.#.#..#..#..##.#.##....#..\n..#...#...####...#......####.##\n..##.#.####........#..#......#.\n.#..#.......#...#.#.........#..\n........#.#....#..#####..#.....\n.#...........#..#..#..#...#....\n....#....#...#.................\n....##..#....##....#..#....#.##\n....#.##.....###...#...##.##...\n......##.#..##.#.#.#....#.#.#..\n##.#...###....#.#..#.#.###....#\n......###..#..#..........##...#\n..........#.##...##..#....##.#.\n.#...#.#..#.#.#..#.....#.......\n.#....#..#.#..#.#...##.#.#.....\n.##.....#...#..##.#........#...\n....#......#.........#....#..##\n.#..#.#.#.#..#..#.#.........#..\n.........#.....#...#....#......\n#..#..#........#...#.#.........\n...#.#.#...##.#.#...#..#......#\n#.#.#.#........#...#..#.....#..\n.###..#..#..###..#..#..........\n.....#......#.#..#...#.......#.\n##.##.........#.......##.......\n#...##.......#..#.#.......#....\n#..#..#.....#...#......#.......\n.#..#..#.##....#.#..#...#...#..\n.#...#.....#..#.........#..#...\n...#.#.#.......#....#..##.....#\n.........#..##.#..#..#.#.......\n#.##.....##..###..#..#..#.##...\n........#......#...##...###..##\n.##....##..#..#..###......#....\n............##......#...#..##..\n...##.......#......#...##.##..#\n...#..#..#.#...####.#.......#..\n..#.##..#....#......#.#.....#..\n..#.##..............#..##.....#\n.....##....#......#....#......#\n......#..#......#.........#..#.\n...#.##.###...###..#.##........\n..........####.#.##.....#..#.##\n#...##...........#...........##\n#.#..#.#....#.#..#....##......#\n.......#...#.....#......#.#.##.\n....#.##..##..........#..#.....\n#.#.#...#......#...#.....#.##.#\n........#.......#..##.....##...\n.....####.#....#.#.............\n")

(defn parse-input [input] (str/split-lines input))

(defn tree? [forest x y]
  (let [forest-width (count (first forest))
        x-mod (mod x forest-width)
        char-at-coords (.charAt (nth forest y) x-mod)]
    (= char-at-coords \#)))

(defn count-trees [forest right-moves down-moves]
  (let [rows (range 0 (count forest) down-moves)            ; generate a seq of rows to visit
        trees (map-indexed
                (fn [x y] (tree? forest (* x right-moves) y))
                rows)]
    (count (filter true? trees))))

(defn part1 [input]
  (let [forest (parse-input input)]
    (count-trees forest 3 1)))

(defn part2 [input]
  (let [forest (parse-input input)]
    (*
      (count-trees forest 1 1)
      (count-trees forest 3 1)
      (count-trees forest 5 1)
      (count-trees forest 7 1)
      (count-trees forest 1 2))))

(comment
  (part1 input)
  (part2 input)
  )
